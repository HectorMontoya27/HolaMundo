PROCESSOR 16F877A
INCLUDE <P16F877A.INC>

V1 EQU H'21'
V2 EQU H'22'
V3 EQU H'23'

V4 EQU H'24'
V5 EQU H'25'

C1 EQU 10H
C2 EQU 10H
C3 EQU 20H

C6 EQU 50H
C7 EQU 50H
C8 EQU 50H

C9 EQU 20H
C10 EQU 20H
C11 EQU 20H

D1 EQU 0XC
D2 EQU 0X18
D3 EQU 0X5
D4 EQU 0XA

ORG 0
GOTO INICIO
ORG 5

INICIO:
	CLRF PORTA ; Limpia los puertos A y B
	CLRF PORTB
	BSF STATUS,RP0
	BCF STATUS,RP1 ; Cambia al banco 1 de RAM
	MOVLW H'0'
	MOVWF TRISB
	CLRF PORTB
	MOVLW H'06'
	MOVWF ADCON1 ; Configura ADCON1
	MOVLW H'3F'
	MOVWF TRISA
	BCF STATUS, RP0 ; Regresa al banco 0 de RAM

CICLO:

	MOVFW PORTA
	XORLW B'000000' ; La entrada es 0000?
	BTFSC STATUS,Z
	GOTO DETENIDO ; Se va al estado PAROPARO

	MOVFW PORTA
	XORLW B'000001'
	BTFSC STATUS,Z
	GOTO HORARIO5

	MOVFW PORTA
	XORLW B'000010'
	BTFSC STATUS,Z
	GOTO ANTI10

	MOVFW PORTA
	XORLW B'000011'
	BTFSC STATUS,Z
	GOTO VUELTAS5

	MOVFW PORTA
	XORLW B'000100'
	BTFSC STATUS,Z
	GOTO ANTIVUELTAS10

DETENIDO:
	MOVLW B'00000000'
	MOVWF PORTB	
	GOTO CICLO

HORARIO5:	
		MOVLW D1
		MOVWF V4
	REGRESO:
		MOVLW B'000001100'
		MOVWF PORTB
	CALL RETARDO
		MOVLW B'00000110'
		MOVWF PORTB
	CALL RETARDO
		MOVLW B'00000011'
		MOVWF PORTB
	CALL RETARDO
		MOVLW B'00001001'
		MOVWF PORTB
	CALL RETARDO
		DECFSZ V4
		GOTO REGRESO
		CALL ESPERAR
		GOTO CICLO

ANTI10:
		MOVLW D2
		MOVWF V4
	REGRESO2:
		MOVLW B'00001100'
		MOVWF PORTB
	CALL RETARDO
		MOVLW B'00000110'
		MOVWF PORTB
	CALL RETARDO
		MOVLW B'00000011'
		MOVWF PORTB
	CALL RETARDO
		MOVLW B'00001001'
		MOVWF PORTB
	CALL RETARDO
		DECFSZ V4
		GOTO REGRESO2
		CALL ESPERAR
	GOTO CICLO

VUELTAS5:
		MOVLW D3
		MOVWF V4
	REGRESO3:
		MOVLW B'00001100'
		MOVWF PORTB
	CALL ESPERAR2
		MOVLW B'00000110'
		MOVWF PORTB
	CALL ESPERAR2
		MOVLW B'00000011'
		MOVWF PORTB
	CALL ESPERAR2
		MOVLW B'00001001'
		MOVWF PORTB
	CALL ESPERAR2
		DECFSZ V4
		GOTO REGRESO3
		CALL ESPERAR
	GOTO CICLO

ANTIVUELTAS10:
		MOVLW D4
		MOVWF V4
	REGRESO4
		MOVLW B'00000011'
		MOVWF PORTB
	CALL ESPERAR2
		MOVLW B'00000110'
		MOVWF PORTB
	CALL ESPERAR2
		MOVLW B'00001100'
		MOVWF PORTB
	CALL ESPERAR2
		MOVLW B'00001001'
		MOVWF PORTB
	CALL ESPERAR2
		DECFSZ V4
		GOTO REGRESO4
		CALL ESPERAR
	GOTO CICLO

RETARDO:
	MOVLW C1
	MOVWF V1
TRES:
	MOVLW C2
	MOVWF V2
DOS:
	MOVLW C3
	MOVWF V3
UNO:
	DECFSZ V3
	GOTO UNO
	DECFSZ V2
	GOTO DOS
	DECFSZ V1
	GOTO TRES
	RETURN

ESPERAR:
	MOVLW C6
	MOVWF V1
E_TRES:
	MOVLW C7
	MOVWF V2
E_DOS:
	MOVLW C8
	MOVWF V3
E_UNO:
	DECFSZ V3
	GOTO E_UNO
	DECFSZ V2
	GOTO E_DOS
	DECFSZ V1
	GOTO E_TRES
	RETURN

ESPERAR2:
	MOVLW C9
	MOVWF V1
E2_TRES:
	MOVLW C10
	MOVWF V2
E2_DOS:
	MOVLW C11
	MOVWF V3
E2_UNO:
	DECFSZ V3
	GOTO E2_UNO
	DECFSZ V2
	GOTO E2_DOS
	DECFSZ V1
	GOTO E2_TRES
	RETURN

END